!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.localq=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],2:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],3:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canMutationObserver=typeof window!=="undefined"&&window.MutationObserver;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div");var observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0;queueList.forEach(function(fn){fn()})});observer.observe(hiddenDiv,{attributes:true});return function nextTick(fn){if(!queue.length){hiddenDiv.setAttribute("yes","no")}queue.push(fn)}}if(canPost){window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],4:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],5:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":4,_process:3,inherits:2}],6:[function(require,module,exports){"use strict";var asap=require("asap");module.exports=Promise;function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof fn!=="function")throw new TypeError("not a function");var state=null;var value=null;var deferreds=[];var self=this;this.then=function(onFulfilled,onRejected){return new Promise(function(resolve,reject){handle(new Handler(onFulfilled,onRejected,resolve,reject))})};function handle(deferred){if(state===null){deferreds.push(deferred);return}asap(function(){var cb=state?deferred.onFulfilled:deferred.onRejected;if(cb===null){(state?deferred.resolve:deferred.reject)(value);return}var ret;try{ret=cb(value)}catch(e){deferred.reject(e);return}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(typeof then==="function"){doResolve(then.bind(newValue),resolve,reject);return}}state=true;value=newValue;finale()}catch(e){reject(e)}}function reject(newValue){state=false;value=newValue;finale()}function finale(){for(var i=0,len=deferreds.length;i<len;i++)handle(deferreds[i]);deferreds=null}doResolve(fn,resolve,reject)}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.resolve=resolve;this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=false;try{fn(function(value){if(done)return;done=true;onFulfilled(value)},function(reason){if(done)return;done=true;onRejected(reason)})}catch(ex){if(done)return;done=true;onRejected(ex)}}},{asap:8}],7:[function(require,module,exports){"use strict";var Promise=require("./core.js");var asap=require("asap");module.exports=Promise;function ValuePromise(value){this.then=function(onFulfilled){if(typeof onFulfilled!=="function")return this;return new Promise(function(resolve,reject){asap(function(){try{resolve(onFulfilled(value))}catch(ex){reject(ex)}})})}}ValuePromise.prototype=Object.create(Promise.prototype);var TRUE=new ValuePromise(true);var FALSE=new ValuePromise(false);var NULL=new ValuePromise(null);var UNDEFINED=new ValuePromise(undefined);var ZERO=new ValuePromise(0);var EMPTYSTRING=new ValuePromise("");Promise.resolve=function(value){if(value instanceof Promise)return value;if(value===null)return NULL;if(value===undefined)return UNDEFINED;if(value===true)return TRUE;if(value===false)return FALSE;if(value===0)return ZERO;if(value==="")return EMPTYSTRING;if(typeof value==="object"||typeof value==="function"){try{var then=value.then;if(typeof then==="function"){return new Promise(then.bind(value))}}catch(ex){return new Promise(function(resolve,reject){reject(ex)})}}return new ValuePromise(value)};Promise.from=Promise.cast=function(value){var err=new Error("Promise.from and Promise.cast are deprecated, use Promise.resolve instead");err.name="Warning";console.warn(err.stack);return Promise.resolve(value)};Promise.denodeify=function(fn,argumentCount){argumentCount=argumentCount||Infinity;return function(){var self=this;var args=Array.prototype.slice.call(arguments);return new Promise(function(resolve,reject){while(args.length&&args.length>argumentCount){args.pop()}args.push(function(err,res){if(err)reject(err);else resolve(res)});fn.apply(self,args)})}};Promise.nodeify=function(fn){return function(){var args=Array.prototype.slice.call(arguments);var callback=typeof args[args.length-1]==="function"?args.pop():null;try{return fn.apply(this,arguments).nodeify(callback)}catch(ex){if(callback===null||typeof callback=="undefined"){return new Promise(function(resolve,reject){reject(ex)})}else{asap(function(){callback(ex)})}}}};Promise.all=function(){var calledWithArray=arguments.length===1&&Array.isArray(arguments[0]);var args=Array.prototype.slice.call(calledWithArray?arguments[0]:arguments);if(!calledWithArray){var err=new Error("Promise.all should be called with a single array, calling it with multiple arguments is deprecated");err.name="Warning";console.warn(err.stack)}return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==="object"||typeof val==="function")){var then=val.then;if(typeof then==="function"){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(--remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){values.forEach(function(value){Promise.resolve(value).then(resolve,reject)})})};Promise.prototype.done=function(onFulfilled,onRejected){var self=arguments.length?this.then.apply(this,arguments):this;self.then(null,function(err){asap(function(){throw err})})};Promise.prototype.nodeify=function(callback){if(typeof callback!="function")return this;this.then(function(value){asap(function(){callback(null,value)})},function(err){asap(function(){callback(err)})})};Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)}},{"./core.js":6,asap:8}],8:[function(require,module,exports){(function(process){var head={task:void 0,next:null};var tail=head;var flushing=false;var requestFlush=void 0;var isNodeJS=false;function flush(){while(head.next){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;if(domain){head.domain=void 0;domain.enter()}try{task()}catch(e){if(isNodeJS){if(domain){domain.exit()}setTimeout(flush,0);if(domain){domain.enter()}throw e}else{setTimeout(function(){throw e},0)}}if(domain){domain.exit()}}flushing=false}if(typeof process!=="undefined"&&process.nextTick){isNodeJS=true;requestFlush=function(){process.nextTick(flush)}}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){requestFlush=setImmediate.bind(window,flush)}else{requestFlush=function(){setImmediate(flush)}}}else if(typeof MessageChannel!=="undefined"){var channel=new MessageChannel;channel.port1.onmessage=flush;requestFlush=function(){channel.port2.postMessage(0)}}else{requestFlush=function(){setTimeout(flush,0)}}function asap(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null};if(!flushing){flushing=true;requestFlush()}}module.exports=asap}).call(this,require("_process"))},{_process:3}],9:[function(require,module,exports){(function(){"use strict";var Promise=typeof module!=="undefined"&&module.exports?require("promise"):this.Promise;var indexedDB=indexedDB||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(!indexedDB){return}function _initStorage(options){var self=this;var dbInfo={db:null};if(options){for(var i in options){dbInfo[i]=options[i]}}return new Promise(function(resolve,reject){var openreq=indexedDB.open(dbInfo.name,dbInfo.version);openreq.onerror=function(){reject(openreq.error)};openreq.onupgradeneeded=function(){openreq.result.createObjectStore(dbInfo.storeName)};openreq.onsuccess=function(){dbInfo.db=openreq.result;self._dbInfo=dbInfo;resolve()}})}function getItem(key,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.get(key);req.onsuccess=function(){var value=req.result;if(value===undefined){value=null}resolve(value)};req.onerror=function(){reject(req.error)}}).catch(reject)});executeDeferedCallback(promise,callback);return promise}function iterate(iterator,callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;if(cursor){var result=iterator(cursor.value,cursor.key);if(result!==void 0){resolve(result)}else{cursor.continue()}}else{resolve()}};req.onerror=function(){reject(req.error)}}).catch(reject)});executeDeferedCallback(promise,callback);return promise}function setItem(key,value,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readwrite").objectStore(dbInfo.storeName);if(value===null){value=undefined}var req=store.put(value,key);req.onsuccess=function(){if(value===undefined){value=null}resolve(value)};req.onerror=function(){reject(req.error)}}).catch(reject)});executeDeferedCallback(promise,callback);return promise}function removeItem(key,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readwrite").objectStore(dbInfo.storeName);var req=store.delete(key);req.onsuccess=function(){resolve()};req.onerror=function(){reject(req.error)};req.onabort=function(event){var error=event.target.error;if(error==="QuotaExceededError"){reject(error)}}}).catch(reject)});executeDeferedCallback(promise,callback);return promise}function clear(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readwrite").objectStore(dbInfo.storeName);var req=store.clear();req.onsuccess=function(){resolve()};req.onerror=function(){reject(req.error)}}).catch(reject)});executeDeferedCallback(promise,callback);return promise}function length(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.count();req.onsuccess=function(){resolve(req.result)};req.onerror=function(){reject(req.error)}}).catch(reject)});executeCallback(promise,callback);return promise}function key(n,callback){var self=this;var promise=new Promise(function(resolve,reject){if(n<0){resolve(null);return}self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var advanced=false;var req=store.openCursor();req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(null);return}if(n===0){resolve(cursor.key)}else{if(!advanced){advanced=true;cursor.advance(n)}else{resolve(cursor.key)}}};req.onerror=function(){reject(req.error)}}).catch(reject)});executeCallback(promise,callback);return promise}function keys(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName);var req=store.openCursor();var keys=[];req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(keys);return}keys.push(cursor.key);cursor.continue()};req.onerror=function(){reject(req.error)}}).catch(reject)});executeCallback(promise,callback);return promise}function executeCallback(promise,callback){if(callback){promise.then(function(result){callback(null,result)},function(error){callback(error)})}}function executeDeferedCallback(promise,callback){if(callback){promise.then(function(result){deferCallback(callback,result)},function(error){callback(error)})}}function deferCallback(callback,result){if(callback){return setTimeout(function(){return callback(null,result)},0)}}var asyncStorage={_driver:"asyncStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};if(typeof define==="function"&&define.amd){define("asyncStorage",function(){return asyncStorage})}else if(typeof module!=="undefined"&&module.exports){module.exports=asyncStorage}else{this.asyncStorage=asyncStorage}}).call(window)},{promise:7}],10:[function(require,module,exports){(function(){"use strict";var Promise=typeof module!=="undefined"&&module.exports?require("promise"):this.Promise;var localStorage=null;try{if(!this.localStorage||!("setItem"in this.localStorage)){return}localStorage=this.localStorage}catch(e){return}function _initStorage(options){var self=this;var dbInfo={};if(options){for(var i in options){dbInfo[i]=options[i]}}dbInfo.keyPrefix=dbInfo.name+"/";self._dbInfo=dbInfo;return Promise.resolve()}var SERIALIZED_MARKER="__lfsc__:";var SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length;var TYPE_ARRAYBUFFER="arbf";var TYPE_BLOB="blob";var TYPE_INT8ARRAY="si08";var TYPE_UINT8ARRAY="ui08";var TYPE_UINT8CLAMPEDARRAY="uic8";var TYPE_INT16ARRAY="si16";var TYPE_INT32ARRAY="si32";var TYPE_UINT16ARRAY="ur16";var TYPE_UINT32ARRAY="ui32";var TYPE_FLOAT32ARRAY="fl32";var TYPE_FLOAT64ARRAY="fl64";var TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length;function clear(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var keyPrefix=self._dbInfo.keyPrefix;for(var i=localStorage.length-1;i>=0;i--){var key=localStorage.key(i);if(key.indexOf(keyPrefix)===0){localStorage.removeItem(key)}}resolve()}).catch(reject)});executeCallback(promise,callback);return promise}function getItem(key,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){try{var dbInfo=self._dbInfo;var result=localStorage.getItem(dbInfo.keyPrefix+key);if(result){result=_deserialize(result)}resolve(result)}catch(e){reject(e)}}).catch(reject)});executeCallback(promise,callback);return promise}function iterate(iterator,callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){try{var keyPrefix=self._dbInfo.keyPrefix;var keyPrefixLength=keyPrefix.length;var length=localStorage.length;for(var i=0;i<length;i++){var key=localStorage.key(i);var value=localStorage.getItem(key);if(value){value=_deserialize(value)}value=iterator(value,key.substring(keyPrefixLength));if(value!==void 0){resolve(value);return}}resolve()}catch(e){reject(e)}}).catch(reject)});executeCallback(promise,callback);return promise}function key(n,callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var result;try{result=localStorage.key(n)}catch(error){result=null}if(result){result=result.substring(dbInfo.keyPrefix.length)
}resolve(result)}).catch(reject)});executeCallback(promise,callback);return promise}function keys(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;var length=localStorage.length;var keys=[];for(var i=0;i<length;i++){if(localStorage.key(i).indexOf(dbInfo.keyPrefix)===0){keys.push(localStorage.key(i).substring(dbInfo.keyPrefix.length))}}resolve(keys)}).catch(reject)});executeCallback(promise,callback);return promise}function length(callback){var self=this;var promise=new Promise(function(resolve,reject){self.keys().then(function(keys){resolve(keys.length)}).catch(reject)});executeCallback(promise,callback);return promise}function removeItem(key,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key);resolve()}).catch(reject)});executeCallback(promise,callback);return promise}function _deserialize(value){if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER){return JSON.parse(value)}var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH);var type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH);var buffer=new ArrayBuffer(serializedString.length*2);var bufferView=new Uint16Array(buffer);for(var i=serializedString.length-1;i>=0;i--){bufferView[i]=serializedString.charCodeAt(i)}switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return new Blob([buffer]);case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}}function _bufferToString(buffer){var str="";var uint16Array=new Uint16Array(buffer);try{str=String.fromCharCode.apply(null,uint16Array)}catch(e){for(var i=0;i<uint16Array.length;i++){str+=String.fromCharCode(uint16Array[i])}}return str}function _serialize(value,callback){var valueString="";if(value){valueString=value.toString()}if(value&&(value.toString()==="[object ArrayBuffer]"||value.buffer&&value.buffer.toString()==="[object ArrayBuffer]")){var buffer;var marker=SERIALIZED_MARKER;if(value instanceof ArrayBuffer){buffer=value;marker+=TYPE_ARRAYBUFFER}else{buffer=value.buffer;if(valueString==="[object Int8Array]"){marker+=TYPE_INT8ARRAY}else if(valueString==="[object Uint8Array]"){marker+=TYPE_UINT8ARRAY}else if(valueString==="[object Uint8ClampedArray]"){marker+=TYPE_UINT8CLAMPEDARRAY}else if(valueString==="[object Int16Array]"){marker+=TYPE_INT16ARRAY}else if(valueString==="[object Uint16Array]"){marker+=TYPE_UINT16ARRAY}else if(valueString==="[object Int32Array]"){marker+=TYPE_INT32ARRAY}else if(valueString==="[object Uint32Array]"){marker+=TYPE_UINT32ARRAY}else if(valueString==="[object Float32Array]"){marker+=TYPE_FLOAT32ARRAY}else if(valueString==="[object Float64Array]"){marker+=TYPE_FLOAT64ARRAY}else{callback(new Error("Failed to get type for BinaryArray"))}}callback(marker+_bufferToString(buffer))}else if(valueString==="[object Blob]"){var fileReader=new FileReader;fileReader.onload=function(){var str=_bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str)};fileReader.readAsArrayBuffer(value)}else{try{callback(JSON.stringify(value))}catch(e){window.console.error("Couldn't convert value into a JSON "+"string: ",value);callback(e)}}}function setItem(key,value,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){if(value===undefined){value=null}var originalValue=value;_serialize(value,function(value,error){if(error){reject(error)}else{try{var dbInfo=self._dbInfo;localStorage.setItem(dbInfo.keyPrefix+key,value)}catch(e){if(e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED"){reject(e)}}resolve(originalValue)}})}).catch(reject)});executeCallback(promise,callback);return promise}function executeCallback(promise,callback){if(callback){promise.then(function(result){callback(null,result)},function(error){callback(error)})}}var localStorageWrapper={_driver:"localStorageWrapper",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};if(typeof define==="function"&&define.amd){define("localStorageWrapper",function(){return localStorageWrapper})}else if(typeof module!=="undefined"&&module.exports){module.exports=localStorageWrapper}else{this.localStorageWrapper=localStorageWrapper}}).call(window)},{promise:7}],11:[function(require,module,exports){(function(){"use strict";var BASE_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var Promise=typeof module!=="undefined"&&module.exports?require("promise"):this.Promise;var openDatabase=this.openDatabase;var SERIALIZED_MARKER="__lfsc__:";var SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length;var TYPE_ARRAYBUFFER="arbf";var TYPE_BLOB="blob";var TYPE_INT8ARRAY="si08";var TYPE_UINT8ARRAY="ui08";var TYPE_UINT8CLAMPEDARRAY="uic8";var TYPE_INT16ARRAY="si16";var TYPE_INT32ARRAY="si32";var TYPE_UINT16ARRAY="ur16";var TYPE_UINT32ARRAY="ui32";var TYPE_FLOAT32ARRAY="fl32";var TYPE_FLOAT64ARRAY="fl64";var TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length;if(!openDatabase){return}function _initStorage(options){var self=this;var dbInfo={db:null};if(options){for(var i in options){dbInfo[i]=typeof options[i]!=="string"?options[i].toString():options[i]}}return new Promise(function(resolve,reject){try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size)}catch(e){return self.setDriver("localStorageWrapper").then(function(){return self._initStorage(options)}).then(resolve).catch(reject)}dbInfo.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+dbInfo.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){self._dbInfo=dbInfo;resolve()},function(t,error){reject(error)})})})}function getItem(key,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName+" WHERE key = ? LIMIT 1",[key],function(t,results){var result=results.rows.length?results.rows.item(0).value:null;if(result){result=_deserialize(result)}resolve(result)},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function iterate(iterator,callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName,[],function(t,results){var rows=results.rows;var length=rows.length;for(var i=0;i<length;i++){var item=rows.item(i);var result=item.value;if(result){result=_deserialize(result)}result=iterator(result,item.key);if(result!==void 0){resolve(result);return}}resolve()},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function setItem(key,value,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){if(value===undefined){value=null}var originalValue=value;_serialize(value,function(value,error){if(error){reject(error)}else{var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+dbInfo.storeName+" (key, value) VALUES (?, ?)",[key,value],function(){resolve(originalValue)},function(t,error){reject(error)})},function(sqlError){if(sqlError.code===sqlError.QUOTA_ERR){reject(sqlError)}})}})}).catch(reject)});executeCallback(promise,callback);return promise}function removeItem(key,callback){var self=this;if(typeof key!=="string"){window.console.warn(key+" used as a key, but it is not a string.");key=String(key)}var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName+" WHERE key = ?",[key],function(){resolve()},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function clear(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName,[],function(){resolve()},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function length(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+dbInfo.storeName,[],function(t,results){var result=results.rows.item(0).c;resolve(result)},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function key(n,callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result)},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function keys(callback){var self=this;var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName,[],function(t,results){var keys=[];for(var i=0;i<results.rows.length;i++){keys.push(results.rows.item(i).key)}resolve(keys)},function(t,error){reject(error)})})}).catch(reject)});executeCallback(promise,callback);return promise}function _bufferToString(buffer){var bytes=new Uint8Array(buffer);var i;var base64String="";for(i=0;i<bytes.length;i+=3){base64String+=BASE_CHARS[bytes[i]>>2];base64String+=BASE_CHARS[(bytes[i]&3)<<4|bytes[i+1]>>4];base64String+=BASE_CHARS[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64String+=BASE_CHARS[bytes[i+2]&63]}if(bytes.length%3===2){base64String=base64String.substring(0,base64String.length-1)+"="}else if(bytes.length%3===1){base64String=base64String.substring(0,base64String.length-2)+"=="}return base64String}function _deserialize(value){if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER){return JSON.parse(value)}var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH);var type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH);var bufferLength=serializedString.length*.75;var len=serializedString.length;var i;var p=0;var encoded1,encoded2,encoded3,encoded4;if(serializedString[serializedString.length-1]==="="){bufferLength--;if(serializedString[serializedString.length-2]==="="){bufferLength--}}var buffer=new ArrayBuffer(bufferLength);var bytes=new Uint8Array(buffer);for(i=0;i<len;i+=4){encoded1=BASE_CHARS.indexOf(serializedString[i]);encoded2=BASE_CHARS.indexOf(serializedString[i+1]);encoded3=BASE_CHARS.indexOf(serializedString[i+2]);encoded4=BASE_CHARS.indexOf(serializedString[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return new Blob([buffer]);case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}}function _serialize(value,callback){var valueString="";if(value){valueString=value.toString()}if(value&&(value.toString()==="[object ArrayBuffer]"||value.buffer&&value.buffer.toString()==="[object ArrayBuffer]")){var buffer;var marker=SERIALIZED_MARKER;if(value instanceof ArrayBuffer){buffer=value;marker+=TYPE_ARRAYBUFFER}else{buffer=value.buffer;if(valueString==="[object Int8Array]"){marker+=TYPE_INT8ARRAY}else if(valueString==="[object Uint8Array]"){marker+=TYPE_UINT8ARRAY}else if(valueString==="[object Uint8ClampedArray]"){marker+=TYPE_UINT8CLAMPEDARRAY}else if(valueString==="[object Int16Array]"){marker+=TYPE_INT16ARRAY}else if(valueString==="[object Uint16Array]"){marker+=TYPE_UINT16ARRAY}else if(valueString==="[object Int32Array]"){marker+=TYPE_INT32ARRAY}else if(valueString==="[object Uint32Array]"){marker+=TYPE_UINT32ARRAY}else if(valueString==="[object Float32Array]"){marker+=TYPE_FLOAT32ARRAY}else if(valueString==="[object Float64Array]"){marker+=TYPE_FLOAT64ARRAY}else{callback(new Error("Failed to get type for BinaryArray"))}}callback(marker+_bufferToString(buffer))}else if(valueString==="[object Blob]"){var fileReader=new FileReader;fileReader.onload=function(){var str=_bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str)};fileReader.readAsArrayBuffer(value)}else{try{callback(JSON.stringify(value))}catch(e){window.console.error("Couldn't convert value into a JSON "+"string: ",value);callback(null,e)}}}function executeCallback(promise,callback){if(callback){promise.then(function(result){callback(null,result)},function(error){callback(error)})}}var webSQLStorage={_driver:"webSQLStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};if(typeof define==="function"&&define.amd){define("webSQLStorage",function(){return webSQLStorage})}else if(typeof module!=="undefined"&&module.exports){module.exports=webSQLStorage}else{this.webSQLStorage=webSQLStorage}}).call(window)},{promise:7}],12:[function(require,module,exports){(function(){"use strict";var Promise=typeof module!=="undefined"&&module.exports?require("promise"):this.Promise;var CustomDrivers={};var DriverType={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"};var DefaultDriverOrder=[DriverType.INDEXEDDB,DriverType.WEBSQL,DriverType.LOCALSTORAGE];var LibraryMethods=["clear","getItem","iterate","key","keys","length","removeItem","setItem"];var ModuleType={DEFINE:1,EXPORT:2,WINDOW:3};var DefaultConfig={description:"",driver:DefaultDriverOrder.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};var moduleType=ModuleType.WINDOW;if(typeof define==="function"&&define.amd){moduleType=ModuleType.DEFINE}else if(typeof module!=="undefined"&&module.exports){moduleType=ModuleType.EXPORT}var driverSupport=function(self){var indexedDB=indexedDB||self.indexedDB||self.webkitIndexedDB||self.mozIndexedDB||self.OIndexedDB||self.msIndexedDB;var result={};result[DriverType.WEBSQL]=!!self.openDatabase;result[DriverType.INDEXEDDB]=!!function(){if(typeof self.openDatabase!=="undefined"&&self.navigator&&self.navigator.userAgent&&/Safari/.test(self.navigator.userAgent)&&!/Chrome/.test(self.navigator.userAgent)){return false}try{return indexedDB&&typeof indexedDB.open==="function"&&typeof self.IDBKeyRange!=="undefined"}catch(e){return false}}();result[DriverType.LOCALSTORAGE]=!!function(){try{return self.localStorage&&"setItem"in self.localStorage&&self.localStorage.setItem}catch(e){return false}}();return result}(this);var isArray=Array.isArray||function(arg){return Object.prototype.toString.call(arg)==="[object Array]"};function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args)})}}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg){for(var key in arg){if(arg.hasOwnProperty(key)){if(isArray(arg[key])){arguments[0][key]=arg[key].slice()}else{arguments[0][key]=arg[key]}}}}}return arguments[0]}function isLibraryDriver(driverName){for(var driver in DriverType){if(DriverType.hasOwnProperty(driver)&&DriverType[driver]===driverName){return true}}return false}var globalObject=this;function LocalForage(options){this._config=extend({},DefaultConfig,options);this._driverSet=null;this._ready=false;this._dbInfo=null;for(var i=0;i<LibraryMethods.length;i++){callWhenReady(this,LibraryMethods[i])}this.setDriver(this._config.driver)}LocalForage.prototype.INDEXEDDB=DriverType.INDEXEDDB;LocalForage.prototype.LOCALSTORAGE=DriverType.LOCALSTORAGE;LocalForage.prototype.WEBSQL=DriverType.WEBSQL;LocalForage.prototype.config=function(options){if(typeof options==="object"){if(this._ready){return new Error("Can't call config() after localforage "+"has been used.")}for(var i in options){if(i==="storeName"){options[i]=options[i].replace(/\W/g,"_")}this._config[i]=options[i]}if("driver"in options&&options.driver){this.setDriver(this._config.driver)}return true}else if(typeof options==="string"){return this._config[options]}else{return this._config}};LocalForage.prototype.defineDriver=function(driverObject,callback,errorCallback){var defineDriver=new Promise(function(resolve,reject){try{var driverName=driverObject._driver;var complianceError=new Error("Custom driver not compliant; see "+"https://mozilla.github.io/localForage/#definedriver");var namingError=new Error("Custom driver name already in use: "+driverObject._driver);if(!driverObject._driver){reject(complianceError);return}if(isLibraryDriver(driverObject._driver)){reject(namingError);return}var customDriverMethods=LibraryMethods.concat("_initStorage");for(var i=0;i<customDriverMethods.length;i++){var customDriverMethod=customDriverMethods[i];if(!customDriverMethod||!driverObject[customDriverMethod]||typeof driverObject[customDriverMethod]!=="function"){reject(complianceError);return}}var supportPromise=Promise.resolve(true);if("_support"in driverObject){if(driverObject._support&&typeof driverObject._support==="function"){supportPromise=driverObject._support()}else{supportPromise=Promise.resolve(!!driverObject._support)}}supportPromise.then(function(supportResult){driverSupport[driverName]=supportResult;CustomDrivers[driverName]=driverObject;resolve()},reject)}catch(e){reject(e)}});defineDriver.then(callback,errorCallback);return defineDriver};LocalForage.prototype.driver=function(){return this._driver||null};LocalForage.prototype.ready=function(callback){var self=this;var ready=new Promise(function(resolve,reject){self._driverSet.then(function(){if(self._ready===null){self._ready=self._initStorage(self._config)}self._ready.then(resolve,reject)}).catch(reject)});ready.then(callback,callback);return ready};LocalForage.prototype.setDriver=function(drivers,callback,errorCallback){var self=this;if(typeof drivers==="string"){drivers=[drivers]}this._driverSet=new Promise(function(resolve,reject){var driverName=self._getFirstSupportedDriver(drivers);var error=new Error("No available storage method found.");if(!driverName){self._driverSet=Promise.reject(error);reject(error);return}self._dbInfo=null;self._ready=null;if(isLibraryDriver(driverName)){if(moduleType===ModuleType.DEFINE){require([driverName],function(lib){self._extend(lib);resolve()});return}else if(moduleType===ModuleType.EXPORT){var driver;switch(driverName){case self.INDEXEDDB:driver=require("./drivers/indexeddb");break;case self.LOCALSTORAGE:driver=require("./drivers/localstorage");break;case self.WEBSQL:driver=require("./drivers/websql")}self._extend(driver)}else{self._extend(globalObject[driverName])}}else if(CustomDrivers[driverName]){self._extend(CustomDrivers[driverName])}else{self._driverSet=Promise.reject(error);reject(error);return}resolve()});function setDriverToConfig(){self._config.driver=self.driver()}this._driverSet.then(setDriverToConfig,setDriverToConfig);this._driverSet.then(callback,errorCallback);return this._driverSet};LocalForage.prototype.supports=function(driverName){return!!driverSupport[driverName]};LocalForage.prototype._extend=function(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties)};LocalForage.prototype._getFirstSupportedDriver=function(drivers){if(drivers&&isArray(drivers)){for(var i=0;i<drivers.length;i++){var driver=drivers[i];if(this.supports(driver)){return driver}}}return null};LocalForage.prototype.createInstance=function(options){return new LocalForage(options)};var localForage=new LocalForage;if(moduleType===ModuleType.DEFINE){define("localforage",function(){return localForage})}else if(moduleType===ModuleType.EXPORT){module.exports=localForage}else{this.localforage=localForage}}).call(window)},{"./drivers/indexeddb":9,"./drivers/localstorage":10,"./drivers/websql":11,promise:7}],13:[function(require,module,exports){var inherits=require("util").inherits;var emitter=require("events").EventEmitter;var Storage=require("./storage");function Queue(opts){var self=this;self._expire=opts.expire||null;self._timeout=opts.timeout||5e3;self._retry=opts.retry||10;self._interval=opts.interval||1e3;self._size=opts.size||4980736;self._name=opts.name||"localq";self._debug=opts.debug||false;self._poll=null;self._storage=new Storage(self._name,self._size);self._storage.push({},function(err){});self.worker=function(job,callback){callback("Worker not specified")};self.log=function(msg){if(self._debug)console.log("[localq] "+msg)};self.start()}inherits(Queue,emitter);Queue.prototype.push=function(job,retry,callback){var self=this;if(typeof retry==="undefined")retry=self._retry;if(typeof retry==="function"){callback=retry;retry=self._retry}self._storage.push({payload:job,retry:retry,stamp:Math.floor(Date.now()/1e3)},callback)};Queue.prototype.flush=function(callback){var self=this;self._storage.flush(callback)};Queue.prototype.pause=function(){var self=this;clearInterval(self._poll)};Queue.prototype.start=function(){var self=this;var tick=function(){self._storage.pull(function(err,job){if(err)self.log(err);if(typeof job==="undefined")return;self.log("Processing job");self.worker(job,function(err){if(!err)return;self.log(err);if(job.retry>0){job.retry--;job.stamp=Math.floor(Date.now()/1e3);self._storage.push(job)}})})};self._poll=setInterval(tick,self._interval)};module.exports=function(opts){return new Queue(opts)}},{"./storage":14,events:1,util:5}],14:[function(require,module,exports){var localforage=require("localforage");function Storage(name,size){var _this=this;localforage.config({name:name,size:size});localforage.getItem("q",function(err,obj){if(err||obj===null)_this.flush();if(typeof obj!=="object")_this.flush();if(!Array.isArray(obj))_this.flush()})}Storage.prototype.push=function(obj,callback){localforage.getItem("q",function(err,q){if(err)return callback("Could not access DB");q.push(obj);localforage.setItem("q",q,callback)})};Storage.prototype.pull=function(callback){localforage.getItem("q",function(err,q){if(err)return callback("Could not access DB");var task=q.shift();localforage.setItem("q",q,function(err){if(err)return callback("Could not update the DB");callback(null,task)})})};Storage.prototype.flush=function(callback){localforage.setItem("q",[],callback)};Storage.prototype.audit=function(callback){localforage.getItem("q",callback)};module.exports=Storage},{localforage:12}]},{},[13])(13)});